<div class="ship-designer">
  <!-- Header -->
  <div class="designer-header">
    <div class="design-title">
      @if (designNameEditing()) {
        <input
          type="text"
          [value]="design()?.name || ''"
          title="Design Name"
          maxlength="50"
          (blur)="updateDesignName($any($event.target).value)"
          (keyup.enter)="updateDesignName($any($event.target).value)"
          autofocus
        />
      } @else {
        <div class="title-container">
          <button class="btn-icon hull-btn" (click)="previewHullName.set(hull()?.name || null)" title="Show Hull Info">
            <img
              [src]="'/assets/tech-icons/' + ((hull()?.img) || 'hull-scout') + '.png'"
              [alt]="hull()?.name || 'Hull Icon'"
              [title]="hull()?.name || 'Hull Icon'"
              class="hull-icon"
              (error)="onHullIconError($event)"
            />
          </button>
          <h3 (click)="designNameEditing.set(true)">{{ design()?.name || 'New Design' }}</h3>
          <button class="btn-icon" (click)="designNameEditing.set(true)" title="Rename Design">✏️</button>
        </div>
      }
    </div>
    <div class="header-actions">
      <button (click)="hullSelectOpen.set(true)" class="btn-secondary">Change Hull</button>
      <button (click)="saveDesign()" class="btn-primary" [disabled]="!stats()?.isValid">
        Save Design
      </button>
      <button (click)="cancelDesign()" class="btn-text">Cancel</button>
    </div>
  </div>

  <!-- Top Summary Bar -->
  @if (stats() && hull()) {
    <div class="summary-bar">
      @if (!stats()!.isStarbase) {
        <div class="summary-item">
          <span class="label">Mass</span>
          <span class="value">{{ stats()!.mass }}kt</span>
        </div>
      }
      @if (!stats()!.isStarbase) {
        <div class="summary-item">
          <span class="label">Fuel</span>
          <span class="value">{{ stats()!.fuelCapacity }}mg</span>
        </div>
      }
      <div class="summary-item">
        <span class="label">Armor</span>
        <span class="value">{{ stats()!.armor }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Shields</span>
        <span class="value">{{ stats()!.shields }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Firepower</span>
        <span class="value">{{ stats()!.firepower }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Accuracy</span>
        <span class="value">{{ stats()!.accuracy }}%</span>
      </div>
      <div class="summary-item">
        <span class="label">Scan</span>
        <span class="value">{{ stats()!.scanRange }} / {{ stats()!.penScanRange }} ly</span>
      </div>
      <div class="summary-item">
        <span class="label">Init</span>
        <span class="value">{{ stats()!.initiative }}</span>
      </div>
      <div class="summary-item wide">
        <span class="label">Cost</span>
        @if (stats()) {
          <app-resource-cost [cost]="stats()!.cost" [inline]="true"></app-resource-cost>
        }
      </div>
    </div>
  }

  <!-- Main Content -->
  <div class="designer-content">
    <!-- Left: Hull and Slots -->
    <app-ship-designer-slots
      [hull]="hull()"
      [design]="design()"
      [selectedSlotId]="selectedSlotId()"
      (slotSelected)="selectSlot($event)"
      (slotHover)="onSlotHover($event)"
      (componentRemoved)="onComponentRemoved($event)"
      (componentIncremented)="onComponentIncremented($event)"
      (slotCleared)="onSlotCleared($event)"
      (componentInfoClick)="onComponentInfoClick($event)"
    ></app-ship-designer-slots>

    <!-- Right: Stats -->
    <div class="stats-panel">
      <app-ship-designer-stats
        [stats]="stats()"
        [hoveredItem]="hoveredItem()"
        [hull]="hull()"
      ></app-ship-designer-stats>
    </div>
  </div>

  <!-- Hull Selection Modal -->
  @if (hullSelectOpen()) {
    <app-ship-designer-hull-selector
      [hulls]="availableHulls()"
      (hullSelected)="selectHull($event)"
      (previewHull)="previewHullName.set($event)"
      (close)="hullSelectOpen.set(false)"
    ></app-ship-designer-hull-selector>
  }

  <!-- Component Selection Modal -->
  @if (componentSelectOpen() && selectedSlotId()) {
    <app-ship-designer-component-selector
      [components]="availableComponentsForSlot()"
      [selectedSlotId]="selectedSlotId()"
      [selectedSlot]="selectedSlot()"
      [currentComponentId]="currentComponent()"
      (componentSelected)="installComponent($event)"
      (componentRemoved)="removeComponent()"
      (previewComponent)="previewComponentName.set($event.name)"
      (close)="componentSelectOpen.set(false)"
    ></app-ship-designer-component-selector>
  }

  @if (previewHullName()) {
    <app-research-unlock-details
      [unlockName]="previewHullName()!"
      (close)="previewHullName.set(null)"
    ></app-research-unlock-details>
  }

  @if (previewComponentName()) {
    <app-research-unlock-details
      [unlockName]="previewComponentName()!"
      (close)="previewComponentName.set(null)"
    ></app-research-unlock-details>
  }
</div>
