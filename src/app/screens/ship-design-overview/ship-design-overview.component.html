<main class="ship-design-screen">
  <!-- Design List Mode -->
  @if (!isDesignerMode()) {
    <div class="design-list-header">
      <h1>Design Management</h1>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs">
        <!-- Starbases Tab Group -->
        <div class="tab-group" [class.active]="activeTab() === 'starbases'">
          <button
            class="tab-btn"
            (click)="setTab('starbases')"
          >
            Starbases ({{ starbaseDesignCount() }}/10)
          </button>
          <button
            type="button"
            class="tab-add-btn"
            (click)="$event.stopPropagation(); startNewDesignFromTab('starbases')"
            [disabled]="!canCreateNew('starbases')"
            [title]="limitMessage('starbases')"
          >
            +
          </button>
        </div>

        <!-- Ships Tab Group -->
        <div class="tab-group" [class.active]="activeTab() === 'ships'">
          <button 
            class="tab-btn" 
            (click)="setTab('ships')"
          >
            Ships ({{ shipDesignCount() }}/16)
          </button>
          <button
            type="button"
            class="tab-add-btn"
            (click)="$event.stopPropagation(); startNewDesignFromTab('ships')"
            [disabled]="!canCreateNew('ships')"
            [title]="limitMessage('ships')"
          >
            +
          </button>
        </div>
      </div>
    </div>

    <!-- Filters (Only for Ships Tab) -->
    @if (activeTab() === 'ships') {
      <div class="filter-ribbon">
        @for (category of availableCategories(); track category.type) {
          <button 
            class="ribbon-btn"
            [class.active]="selectedCategories().has(category.type)"
            (click)="toggleCategory(category.type)"
            [title]="category.config.label"
          >
            {{ category.config.icon }} <span class="btn-label">{{ category.config.label }}</span>
          </button>
        }
      </div>
    }

    <div class="designs-grid">
      @if (designDisplays().length === 0) {
        <div class="empty-state">
           <p>No designs found for this category.</p>
        </div>
      }
      
      @for (design of designDisplays(); track design.id) {
        <app-ship-design-item
           [design]="design"
           [count]="getShipCount(design.id)"
           (edit)="onEditDesign($event)"
           (delete)="onDeleteDesign($event)"
           (clone)="onCloneDesign($event)"
           (preview)="onPreviewDesign($event)"
        ></app-ship-design-item>
      }
    </div>
  }

  <!-- Designer Mode -->
  @if (isDesignerMode()) {
    <app-ship-designer
      [hullFilter]="designerHullFilter()"
      [openHullSelectorOnInit]="openHullSelectorOnStart()"
      (save)="onDesignSaved()"
      (cancel)="onDesignCanceled()"
    ></app-ship-designer>
  }

  @if (previewOpen()) {
    <app-hull-preview-modal
      [hull]="previewHull()"
      [design]="previewDesign()"
      [stats]="previewStats()"
      [title]="previewTitle()"
      (close)="previewOpen.set(false)"
    ></app-hull-preview-modal>
  }
</main>
